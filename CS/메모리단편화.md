# 메모리 단편화

 ![header](https://capsule-render.vercel.app/api?color=gradient&type=waving)

### 단편화 현상

메모리 관리 기법에는 크게 연속 메모리 관리와 불연속 메모리 관리로 나뉘는데, 각 관리 기법에 따라 외부 , 내부 단편화 현상이 발생한다.

1. **연속 메모리 기법**: <U>프로그램 전체</U>가 메모리에 연속적으로 할당되어야 하는 관리 기법, 메모리 공간이 충분히 남아 있어도 연속된 블록이 없으면 프로세스를 할당할 수 없다(**외부 단편화 현상**).

- **고정 분할 기법**: 메모리가 고정된 파티션(길이)으로 분할되어 프로세스가 해당 파티션에 로드
-> 프로세스 로드에 필요한 용량보다 더 큰 크기의 파티션으로 구분되면 여부의 메모리 생김, 이는 **내부 단편화**를 발생시킨다. 
<br>
<br>
- **동적 분할 기법**: 파티션들이 프로세스의 크기에 맞춘 크기로 동적으로 생성된다. -> 메모리를 적재하고 해제하는 과정을 반복하면서 비연속적인 메모리 틈이 생기고, 이는 **외부 단편화**를 발생시킨다.
<br>
<br>

2. **불연속 메모리 관리 기법**: <U>프로그램의 일부</U>를 서로 다른 주소 공간에 할당될 수 있는 기법이며, 페이지 혹은 세그멘테이션 단위로 나뉘어 로드가 된다. 프로세스가 할당받은 블록 내에서 사용하지 않는 공간이 생길 수 있다. (**내부 단편화 현상**)

- **Page**: 프로세스를 <U>고정된 크기</U>의 작은 논리적 블록(가상 메모리 상에서)들로 나눴을때, 그 블록들을 페이지라 함

- **Frame**: 페이지가 실체화되어 주 기억장치(RAM)메모리에 로드되는 블록  

- **Segment**: <U>서로 다른 크기</U>의 논리적 메모리 블록을 의미

### 단편화 현상 해결 방법 

메모리 단편화의 해결 방안으로는 가상 메모리를 이용한 페이징과 세그멘테이션이 있지만 여전히 모든 단편화 현상을 해결하지 못하는 단점이 존재한다.

1. **페이징 기법**: 사용하지 않는 프레임을 페이지로 옮기고, 필요한 메모리를 페이지 단위로 프레임에 옮기는 방법을 말한다. 가상 메모리를 같은 크기의 블록으로 나눈 것을 **페이지**, RAM을 페이지와 같은 크기의 블록으로 나눈 것을 **프레임**이라 한다. 페이지와 프레임을 대응시키기 위해 page Mapping 과정이 필요해서 **Page Table**을 만든다. 페이징 기법을 사용하면 연속적이지 않은 공간도 활용할 수 있기 때문에 외부 단편화 문제를 해결할 수 있다. 하지만 고정된 크기로 페이지를 할당하기 때문에 내부 단편화 현상은 피할 수가 없다.


2. **세그멘테이션(Segmentation) 기법**: 페이징 기법과 달리 세그멘테이션에서는 가상 메모리를 서로 크기가 다른 논리적 단위인 세그먼트로 분할한 뒤에 메모리를 할당하여 실제 메모리 주소로 변환을 하는 것이다. 페이징 기법과 마찬가지로 mapping을 위해 세그먼트 테이블이 필요하다. 프로세스가 필요한 메모리만큼 할당해주기 때문에 내부 단편화는 발생하지 않지만, 메모리를 해제하면 생기는 틈, 즉 외부 단편화 문제는 해결하지 못한다.

3. **메모리 풀(Memory Pool) 기법** : 미리 할당된 고정 크기의 메모리 블록들(pool)을 관리하여 메모리 할당 및 해제를 최적화하는 방식이다.

    메모리 풀의 작동 원리

    1. **초기화 단계** : 애플리케이션 실행 전에 일정 크기의 메모리 블록을 미리 할당하여 메모리 풀을 생성한다.
이 풀은 동일한 크기의 작은 메모리 조각(chunk)들로 구성된다.

    2. **할당 단계**: 애플리케이션에서 메모리를 요청하면, 메모리 풀에서 준비된 블록을 하나 반환한다. 새로운 메모리를 동적으로 할당하지 않고, 기존 풀에서 재사용하기 때문에 할당 속도가 빠르다.

    3. **해제 단계**: 사용이 끝난 메모리 블록은 메모리 풀로 반환되며, 다시 사용 가능 상태가 된다.


    메모리 해제를 일반적인 방식으로 처리하지 않기 때문에 메모리 단편화를 방지할 수 있다.

    하지만 프로그램 시작 시 미리 메모리를 할당해두어야 하므로, 사용되지 않는 메모리 블록이 생길 경우 메모리 낭비가 발생할 수 있다.

    게임 엔진의 오브젝트 생성 및 제거, 네트워크 패킷 처리, 데이터베이스 메모리 관리







































