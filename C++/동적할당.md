<h1>동적 할당</h1>

 ![header](https://capsule-render.vercel.app/api?color=gradient&type=waving)

### 동적 할당

![StackFrameImage](/Images/DynamicAlloc1.png)




메모리(RAM)에 프로세스가 로드되는 메모리 공간에는 크게 4가지의 섹션이 있다.

-**Code 영역**: 실행할 프로그램의 코드 


-**Data 영역**: 전역 변수, 정적 변수(상수)

1.  .BSS 세그먼트: 선언하고 초기화 되지 않은 전역변수
2. .DATA 세그먼트: 초기화된 전역변수/전역상수가 위치하는 영역.
3. .RODATA 세그먼트: 문자열이나 전역 Const(상수) 

    <U>선언과 초기화를 해두면 프로그램이 실행되는 도중에는 '무조건' 사용되는 영역</U>

    컴파일 타임에 미리 정해진 크기를 정하며, 얼마나 쓰일지 모르는 상태임에도 여유공간을 고려해서 할당해둬야하므로 공간의 낭비를 발생시킨다.

<br>
<br>
<br>
<br>


-**Stack 영역**: 
<br>
<br>
* 매개변수, 지역변수가 위치
* 컴파일 타임에 크기가 결정됨 
* 함수가 끝나면 같이 정리되는 불안정한 메모리 {} 기준 스택프레임이 메모리에 로드되고 해제됨 

    스택은 이와 같은 특징이 있지만, 주로 함수를 호출할때 함수를 위한 프레임을 로드하고 해제할때 사용되며,

    <pre>
    <code>
    Class명 클래스이름[500* 100000];
    </code>
    </pre>
    와 같이 대량의 클래스 전용 메모리를 스택에 미리 할당하기에는 용량이 넉넉치 않아 컴파일 에러를 발생시킨다.

<br>
<br>

데이터 섹션과 스택 섹션의 메모리 낭비 단점을 해결하기 위해, 런타임 도중 필요한 크기의 메모리를 할당받고, 생성/소멸 시점을 관리할 수 있는 새로운 메모리 영역이 필요하여 나온 영역이 <B>Heap 영역</B>

<br>
<br>

-**Heap 영역**: 런타임 시 크기가 결정됨(가변적), 동적 할당을 위한 영역

<b>동적 할당</b>의 흐름을 살펴보기 전에 먼저 유저 영역과 커널 영역에 대해서 알아보자.

<br>
<br>


<b>유저 영역</b>: 

* 사용자가 직접 컴퓨터에서 설치한 소프트웨어나 애플리케이션이 실행되는 영역

* 유저 영역의 프로그램들은 직접적으로 하드웨어나 핵심 시스템 자원에 접근을 제한됨

* 하드웨어와의 상호작용은 커널을 통해 간접적으로 진행

<br>
<br>

<b>커널 영역</b>:

* 운영체제의 핵심 부분인 커널이 실행되는 메모리 영역
* <u>시스템의 모든 핵심 기능과 하드웨어 제어</u>를 담당하며, 사용자 공간과는 별도로 존재하며 시스템의 안정성과 보안성을 보장
* 직접적인 하드웨어 접근을 허용하며, 프로세스의 생성, 종료, 스케쥴링, 컨텍스트 스위칭 등의 기능을 담당

* <u><b>물리 메모리 할당</b>, 가상 메모리 관리 등의 메모리 관련 작업을 수행</u>


유저 영역에서 실행되는 프로그램이 커널의 기능이나 서비스를 필요로 할 때, 시스템 호출(<b>System Call</b>)을 통해 요청함.

<b>System Call</b>을 호출하면, 사용자 공간에서 커널 공간으로의 전환(<b>Context Switch</b>)가 일어나게 되며, 커널에 해당 요청을 처리한 후 다시 사용자 공간으로 제어를 반환한다.



메모리 할당을 위해 유저 영역 프로그램에서 커널에 요청하고 요구된 메모리를 반환하는 과정:

 1. 유저 영역) 운영체제에서 제공하는 API를 호출(System Call)

 2. 커널 영역) 메모리를 할당해서 건네줌 

 3. 유저 영역) 할당된 메모리를 사용

<br>
<br>
<br>

일반적으로 유저 영역에서 메모리를 요청하면 , 일단 커널은 여유분의 큰 메모리를 할당

<pre>
<code>
[ {   }                 ] <<- [] 영역 중에서 {} 영역 분의 메모리 사용
	
malloc , new 등의 명령어를 사용하여 여분({})의 메모리를 사용

 C++ 에서는 기본적으로 CRT(C런타임 라이브러리)의 [힙 관리자]를 통해 힙 영역 사용
</code>
</pre>

<br>
<br>

<b>Heap에 메모리 할당</b>을 하기 위해 사용하는 <u>함수 및 연산자</u>

ex) malloc , free , new ,delete , new[] ,delete[]


   
















